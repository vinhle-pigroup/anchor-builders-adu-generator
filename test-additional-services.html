<!DOCTYPE html>
<html>
<head>
    <title>Additional Services Debug Test</title>
    <style>
        body { font-family: Arial; padding: 20px; }
        table { border-collapse: collapse; width: 100%; margin: 20px 0; }
        td { border: 1px solid #ddd; padding: 8px; }
        .phase-header { background: #f0f0f0; font-weight: bold; }
        .cost-value { text-align: right; }
        .debug { background: yellow; padding: 10px; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>Testing Additional Services Display</h1>
    
    <div class="debug">
        <h3>Test Case 1: Template Before Processing</h3>
        <pre>
{{#if ADD_ON_WORK_EXISTS}}
<tr>
    <td colspan="3" class="phase-header">Phase 3: Additional Services</td>
</tr>
{{#each ADD_ON_ITEMS}}
<tr class="milestone-row additional-service">
    <td class="milestone-number">{{number}}</td>
    <td>{{name}} - {{description}}</td>
    <td class="cost-value">${{cost}}</td>
</tr>
{{/each}}
<tr style="background: #f8f9fa;">
    <td colspan="2" style="text-align: right;">Additional Services Total:</td>
    <td style="text-align: right;">${{ADDITIONAL_SERVICES_TOTAL}}</td>
</tr>
{{/if}}
        </pre>
    </div>

    <div class="debug">
        <h3>Test Case 2: Expected After Processing (with add-ons)</h3>
        <table>
            <tr>
                <td colspan="3" class="phase-header">Phase 3: Additional Services</td>
            </tr>
            <tr class="milestone-row additional-service">
                <td class="milestone-number">A1</td>
                <td>Extra Bedroom - Additional bedroom</td>
                <td class="cost-value">$10,000</td>
            </tr>
            <tr class="milestone-row additional-service">
                <td class="milestone-number">A2</td>
                <td>Extra Bathroom - Additional bathroom</td>
                <td class="cost-value">$8,000</td>
            </tr>
            <tr style="background: #f8f9fa;">
                <td colspan="2" style="text-align: right;">Additional Services Total:</td>
                <td style="text-align: right;">$18,000</td>
            </tr>
        </table>
    </div>

    <div class="debug">
        <h3>What Should Happen:</h3>
        <ol>
            <li>{{#if ADD_ON_WORK_EXISTS}} expands to show content when hasAddOnWork = true</li>
            <li>{{#each ADD_ON_ITEMS}} gets replaced with actual rows</li>
            <li>{{ADDITIONAL_SERVICES_TOTAL}} gets replaced with calculated total</li>
            <li>All three should appear together when add-ons are selected</li>
        </ol>
    </div>

    <div class="debug">
        <h3>Common Issues:</h3>
        <ul>
            <li>❌ Subtotal row outside {{#if}} block → shows even without add-ons</li>
            <li>❌ ADDITIONAL_SERVICES_TOTAL not calculated → shows as {{ADDITIONAL_SERVICES_TOTAL}}</li>
            <li>❌ Wrong data source for calculation → total doesn't match rows</li>
            <li>❌ Duplicate replacement → value gets overwritten</li>
        </ul>
    </div>
</body>
</html>